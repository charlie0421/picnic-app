<!DOCTYPE html>
<html>
<head>
    <base href="$FLUTTER_BASE_HREF">

    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="description" content="A new Flutter project.">

    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="your_app_name">
    <link rel="apple-touch-icon" href="icons/Icon-192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png"/>

    <title>Your App Title</title>
    <link rel="manifest" href="manifest.json">

    <style>
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #ffffff;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            z-index: 9999;
        }

        .loading-container.hide {
            opacity: 0;
        }

        .loading-indicator {
            width: 50px;
            height: 50px;
            margin-bottom: 20px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: #333333;
            font-family: Arial, sans-serif;
            font-size: 18px;
            margin-top: 10px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: #f3f3f3;
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: #3498db;
            border-radius: 2px;
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
    </style>
</head>
<body>
<div class="loading-container" id="loading">
    <div class="loading-indicator"></div>
    <div class="loading-text">앱 시작하는 중...</div>
    <div class="loading-progress">
        <div class="progress-bar"></div>
    </div>
</div>

<!-- Flutter initialization script -->
<script src="flutter.js"></script>
<script>
    window.addEventListener('load', function(ev) {
        // Flutter 초기화 준비
        _flutter = {
            loader: {
                loadEntrypoint: function(options) {
                    return new Promise(function(resolve, reject) {
                        try {
                            var main = document.createElement('script');
                            main.src = 'main.dart.js';
                            main.type = 'text/javascript';

                            // InAppWebView 설정
                            window.flutter_inappwebview = {
                                nativeCommunication: {
                                    networkProxySettings: function() {
                                        return {
                                            autoDetect: false,
                                            autoConfig: {},
                                            autoConfigUrl: '',
                                            bypass: [],
                                            host: '',
                                            password: '',
                                            port: 0,
                                            username: ''
                                        };
                                    }
                                }
                            };

                            main.addEventListener('load', function() {
                                if (options.onEntrypointLoaded) {
                                    options.onEntrypointLoaded({
                                        initializeEngine: function() {
                                            return Promise.resolve({
                                                runApp: function() {
                                                    // 로딩 화면 제거
                                                    var loading = document.getElementById('loading');
                                                    if (loading) {
                                                        loading.classList.add('hide');
                                                        setTimeout(function() {
                                                            loading.remove();
                                                        }, 500);
                                                    }
                                                }
                                            });
                                        }
                                    });
                                }
                                resolve();
                            });

                            document.body.appendChild(main);
                        } catch (error) {
                            console.error('Flutter 초기화 중 오류 발생:', error);
                            reject(error);
                        }
                    });
                }
            }
        };

        // Flutter 앱 시작
        _flutter.loader.loadEntrypoint({
            serviceWorker: {
                serviceWorkerVersion: '{{flutter_service_worker_version}}',
            },
            onEntrypointLoaded: function(engineInitializer) {
                engineInitializer.initializeEngine().then(function(appRunner) {
                    appRunner.runApp();
                });
            }
        });
    });
</script>
<script type="application/javascript" src="/assets/packages/flutter_inappwebview_web/assets/web/web_support.js"></script>
</body>
</html>
